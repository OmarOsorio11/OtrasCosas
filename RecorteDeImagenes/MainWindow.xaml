<Window x:Class="RecorteDeImagenes.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RecorteDeImagenes"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">
    <Window.Resources>
        <Style x:Key="CornerHandleStyle" TargetType="Thumb">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Background" Value="#007ACC"/>
            <Setter Property="BorderBrush" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Ellipse Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Viewbox Grid.Row="0" Margin="20">
            <Canvas x:Name="CanvasNativo" 
                    Width="{Binding ElementName=ImgTarget, Path=ActualWidth}"
                    Height="{Binding ElementName=ImgTarget, Path=ActualHeight}"
                    MouseDown="CanvasNativo_MouseDown" 
                    MouseMove="CanvasNativo_MouseMove" 
                    MouseUp="CanvasNativo_MouseUp"
                    Background="Transparent">

                <Image x:Name="ImgTarget" Stretch="None" RenderOptions.BitmapScalingMode="HighQuality"/>

                <Path Fill="#AA000000" x:Name="OverlayPath" IsHitTestVisible="False">
                    <Path.Data>
                        <CombinedGeometry GeometryCombineMode="Exclude">
                            <CombinedGeometry.Geometry1>
                                <RectangleGeometry x:Name="FullRect" Rect="0,0,10000,10000"/>
                            </CombinedGeometry.Geometry1>
                            <CombinedGeometry.Geometry2>
                                <RectangleGeometry x:Name="SelectionRect" Rect="0,0,0,0"/>
                            </CombinedGeometry.Geometry2>
                        </CombinedGeometry>
                    </Path.Data>
                </Path>

                <Rectangle x:Name="SelectionBorder" Stroke="#007ACC" StrokeThickness="2" 
                           StrokeDashArray="4 2" Visibility="Collapsed" IsHitTestVisible="False"/>

                <Thumb x:Name="CornerTopLeft" Style="{StaticResource CornerHandleStyle}" Visibility="Collapsed" DragDelta="HandleThumb" Cursor="SizeNWSE"/>
                <Thumb x:Name="CornerTopRight" Style="{StaticResource CornerHandleStyle}" Visibility="Collapsed" DragDelta="HandleThumb" Cursor="SizeNESW"/>
                <Thumb x:Name="CornerBottomLeft" Style="{StaticResource CornerHandleStyle}" Visibility="Collapsed" DragDelta="HandleThumb" Cursor="SizeNESW"/>
                <Thumb x:Name="CornerBottomRight" Style="{StaticResource CornerHandleStyle}" Visibility="Collapsed" DragDelta="HandleThumb" Cursor="SizeNWSE"/>
            </Canvas>
        </Viewbox>

        <Border Grid.Row="1" Background="#2D2D30" Padding="15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Content="↩ Regresar" Click="BtnUndo_Click" 
            Width="90" Height="35" Margin="5" 
            Background="#4E4E4E" Foreground="White" BorderThickness="0"/>

                <Button Content="Limpiar" Click="BtnClear_Click" Width="80" Height="35" Margin="5" Background="#3F3F46" Foreground="White" BorderThickness="0"/>

                <Button Content="✂ Recortar" Click="BtnApplyCrop_Click" Width="120" Height="35" Margin="5" Background="#555555" Foreground="White" FontWeight="Bold" BorderThickness="0"/>

                <Button Content="✔ Aceptar y Guardar" Click="BtnAcceptSave_Click" Width="180" Height="35" Margin="5" Background="#28A745" Foreground="White" FontWeight="Bold" BorderThickness="0"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>